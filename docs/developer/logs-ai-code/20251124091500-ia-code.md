# IA Change Template — Code-Brain

## 1. Contexto consumido
- context-index.yaml → AGENTS.md → project-guide.md
- docs/tasks/tasks-telemetry.md (TTEL-003,007,008,010,014)
- src/telemetry/*, src/cli/bootstrap.ts, src/usecases/deploy/deploy.usecase.ts
- tests/telemetry/*.test.ts

## 2. Objetivo da alteração
- Completar fase de telemetria opcional: prompt inicial, wrappers, envio de eventos e integração com deploy.
- Adicionar teste de envio com mock remoto.

## 3. Decisões e justificativas
- Prompt só roda em TTY e fora de CI; respeita env override para evitar bloqueios.
- Envio condicionado a opt-in + endpoint configurável; falhas não interrompem fluxo.
- Wrappers específicos para deploy (start/finish/error) para manter rastreabilidade mínima sem dados pessoais.

## 4. Implementação
- Arquivos novos: src/telemetry/startup.ts, src/telemetry/send.ts, src/telemetry/events/deploy.ts, tests/telemetry/send.test.ts, docs/developer/logs-ai-code/20251124091500-ia-code.md.
- Arquivos alterados: src/telemetry/telemetry.optin.ts, src/cli/bootstrap.ts, src/usecases/deploy/deploy.usecase.ts, docs/tasks/tasks-telemetry.md.
- Testes: `npm test -- tests/telemetry/optin.test.ts tests/telemetry/create-event.test.ts tests/telemetry/buffer.test.ts tests/telemetry/send.test.ts` (incl. via full run; send.test adicionada).

## 5. Revisão humana
- Endpoint definido via `AZION_FLOW_TELEMETRY_ENDPOINT`; confirmar URL alvo real. Prompt mensagem curta — ajustar copy se necessário.

## 6. Follow-ups
- Avaliar compressão/rotacionamento de events.log e integração com outros comandos (cli_started, steps_executed).
- Considerar suprimir prompt quando config file existir com enabled false (já feito) e adicionar feedback textual em `telemetry enable/disable`.

## 7. Next Steps
- Expandir wrappers para config_loaded/steps_executed e acionar em pontos-chave.
- Implementar retry/backoff no envio e métricas de tamanho do buffer.
