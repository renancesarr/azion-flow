# IA Change Template — Code-Brain

> Salve como `code-brain/developer/logs-ai-code/<timestamp>-ia-code.md`.
> Cite sempre os IDs envolvidos (`IN-XXXX`, `UC-XXXX`, `T-XXXX`) e os validadores executados.

## 1. Contexto consumido

- context-index.yaml → AGENTS.md → project-guide.md → docs/architecture.md → docs/stack.md → docs/tasks/tasks-telemetry.md → src/cli/commands/telemetry.ts → src/telemetry/*.

## 2. Objetivo da alteração

- Executar tarefas de telemetria opcionais não bloqueantes: TTEL-001, TTEL-002, TTEL-004, TTEL-005, TTEL-006.
- Escopo: verificar opt-in, comando enable/disable, estrutura de evento, criação de evento e buffer em arquivo local.

## 3. Decisões e justificativas

- Alternativa A: adiar até comando de deploy; descartada para avançar infraestrutura de telemetria.
- Alternativa B (escolhida): implementar utilidades auto contidas, sem envio de rede (TTEL-007 fica para depois).
- Riscos: sem flags `NO_COLOR`/silencioso na telemetria; sem testes automatizados. Mitigação futura quando integrar ao CLI.

## 4. Implementação

- Arquivos gerados:
  - `src/telemetry/telemetry.optin.ts` (isTelemetryEnabled com env + arquivo)
  - `src/telemetry/event.ts` (tipo TelemetryEvent)
  - `src/telemetry/create-event.ts` (criação de evento com metadados)
  - `src/telemetry/buffer.ts` (append JSON lines em `.azionflow/events.log`)
  - `src/cli/commands/telemetry.ts` (enable/disable gravando `.azionflow/telemetry.json`)
- Nenhum arquivo removido.
- Não executado build/test nesta iteração.

## 5. Revisão humana

- Confirmar local correto para `.azionflow/` (home vs working dir); hoje usa `cwd`.
- Avaliar necessidade de tratamento de erros/mensagens amigáveis no comando.

## 6. Follow-ups

- Implementar TTEL-003 (aviso inicial) e TTEL-007/TTEL-008 (envio) quando fluxo permitir.
- Adicionar testes unitários para opt-in, createEvent e buffer.

## 7. Next Steps

- Integrar telemetria ao CLI router (comando telemetry) e aos fluxos de deploy ao final de cada execução (após TDEP-REAL-007).
