# IA Change Template — Code-Brain

## 1. Contexto consumido
- context-index.yaml → AGENTS.md → project-guide.md
- docs/tasks/tasks-providers-real.md (TPROVREAL-001..022)
- src/providers/azion/http/*, azion.storage/application/domain providers
- tests/providers/* (http/application/domain/storage)

## 2. Objetivo da alteração
- Implementar providers reais da Azion com headers, timeout, logging e métodos HTTP (TPROVREAL-001..009).
- Conectar providers de storage/application/domain a endpoints reais e upload (TPROVREAL-010..018).
- Criar testes de integração via fetch mock para HTTP client e providers (TPROVREAL-019..022).
- Escopo: apenas camada providers HTTP/Azion e tarefas listadas; sem alterar domínios ou CLI.

## 3. Decisões e justificativas
- Usar Authorization `Token` (amostra oficial) em vez de Bearer; mantém compatibilidade com cURL fornecido.
- Timeout via AbortController para evitar requests pendurados; erros envelopados em AzionHttpError para UX amigável.
- Logging condicionado a `AZION_FLOW_DEBUG=1` para evitar ruído em produção.
- Upload binário envia `application/octet-stream`, mantendo JSON por padrão para demais chamadas.

## 4. Implementação
- Arquivos gerados: azion-flow/src/providers/azion/http/http-config.ts; azion-flow/docs/developer/logs-ai-code/20251124083200-ia-code.md.
- Arquivos alterados principais: azion-flow/src/providers/azion/http/http-client.ts, endpoints.ts; azion-flow/src/providers/azion/azion.storage.ts; azion-flow/src/providers/azion/azion.application.ts; azion-flow/src/providers/azion/azion.domain.ts; azion-flow/tests/providers/azion-http.client.test.ts; azion-flow/tests/providers/azion.storage.provider.test.ts; azion-flow/tests/providers/azion.application.provider.test.ts; azion-flow/tests/providers/azion.domain.provider.test.ts; azion-flow/docs/tasks/tasks-providers-real.md.
- Notas: adicionados métodos GET/POST/PATCH/DELETE, timeout, logging; builders de endpoints; ensureBucket com listagem; ensureDomain via PATCH config; upload com header binário; testes vitest rodados: `npm test -- azion-http.client.test.ts azion.storage.provider.test.ts azion.application.provider.test.ts azion.domain.provider.test.ts` (todos verdes).

## 5. Revisão humana
- Confirmar se Authorization deve permanecer `Token` ou mudar para Bearer segundo contratos mais recentes.
- Validar se upload via POST é aceitável ou se a API exige PUT/multipart (ajustar quando integrar real).

## 6. Follow-ups
- TPROVREAL-013 pode exigir PUT/multipart real; ajustar quando integrar com Azion real.
- Verificar tasks TSERVREAL/steps para integração completa com domínios e workflow de deploy.

## 7. Next Steps
- Integrar providers reais aos serviços de domínio (TSERVREAL-013..018) consumindo novos métodos.
- Exercitar endpoints reais de storage/application/domain usando token válido e ajustar headers/verbos conforme resposta da API.
