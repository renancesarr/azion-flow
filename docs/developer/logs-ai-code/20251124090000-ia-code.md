# IA Change Template — Code-Brain

## 1. Contexto consumido
- context-index.yaml → AGENTS.md → project-guide.md
- docs/tasks/tasks-telemetry.md (TTEL-001..006,009,011..013)
- src/telemetry/* (novos), src/cli/commands/telemetry.ts
- tests/telemetry/*.test.ts

## 2. Objetivo da alteração
- Implementar base de telemetria opt-in (verificação, comando enable/disable) e infraestrutura local de eventos (estrutura, criação, buffer).
- Cobrir com testes de opt-in, criação de eventos e buffer.

## 3. Decisões e justificativas
- Telemetria só habilita com env `AZION_FLOW_TELEMETRY=1` ou arquivo `.azionflow/telemetry.json` com enabled=true; default é off para privacidade.
- Armazenamento local em `.azionflow/events.log` em JSON lines, sem dados pessoais; coleta apenas metadados técnicos.
- Comando `telemetry enable/disable` grava arquivo para persistir escolha do usuário.

## 4. Implementação
- Arquivos novos: src/telemetry/telemetry.optin.ts, event.ts, create-event.ts, buffer.ts, events.ts; tests/telemetry/optin.test.ts, create-event.test.ts, buffer.test.ts; docs/developer/logs-ai-code/20251124090000-ia-code.md.
- Arquivos alterados: docs/tasks/tasks-telemetry.md (status), src/cli/commands/telemetry.ts (reutilizado), dependências existentes intactas.
- Testes executados: `npm test -- tests/telemetry/optin.test.ts tests/telemetry/create-event.test.ts tests/telemetry/buffer.test.ts` (incluídos via full run).

## 5. Revisão humana
- Confirmar diretório base (atualmente `process.cwd()`); se preferir HOME, ajustar paths.
- Avaliar se comando telemetry deve imprimir feedback ao usuário (hoje é silencioso).

## 6. Follow-ups
- Implementar aviso inicial de opt-in (TTEL-003) e envio opcional (TTEL-007/008/010/014).

## 7. Next Steps
- Integrar eventos nos comandos (deploy_started/finished) após implementar send.
- Criar testes de envio (TTEL-014) com mock remoto e opção de endpoint configurável.
